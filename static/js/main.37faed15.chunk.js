(this["webpackJsonpchat-app"]=this["webpackJsonpchat-app"]||[]).push([[0],{199:function(e,t,n){},364:function(e,t,n){"use strict";n.r(t);var c=n(3),a=n(0),r=n(28),s=n.n(r),i=n(49),o=(n(198),n(13)),l=(n(199),n(16)),u=n.n(l),j=n(18),d=n(23),b=n(373),h=n(377),O=n(378),f=n(379),m=n(380),x=n(375),p=n(92),v=n(91),g=(n(201),n(203),n(365),d.a.initializeApp({apiKey:"AIzaSyDQwu5xUvKVkupe8wwflYH2xBuKcUzAuO8",authDomain:"chat-web-app-4b958.firebaseapp.com",projectId:"chat-web-app-4b958",storageBucket:"chat-web-app-4b958.appspot.com",messagingSenderId:"820885800593",appId:"1:820885800593:web:9aeb9815a5728aa5a86130"})),k=g.auth(),w=g.database(),C=g.storage(),N=function(){var e=function(){var e=Object(j.a)(u.a.mark((function e(t){var n,c,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.signInWithPopup(t);case 3:n=e.sent,c=n.additionalUserInfo,a=n.user,c.isNewUser&&w.ref("/profiles/".concat(a.uid)).set({name:a.displayName,createdAt:d.a.database.ServerValue.TIMESTAMP}),b.a.success("Signed In",4e3),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),b.a.error(e.t0.message,4e3);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}();return Object(c.jsx)(h.a,{children:Object(c.jsx)(O.a,{className:"mt-page",children:Object(c.jsx)(f.a,{children:Object(c.jsx)(m.a,{xs:24,md:12,mdOffset:6,children:Object(c.jsxs)(x.a,{children:[Object(c.jsxs)("div",{className:"text-center",children:[Object(c.jsx)("h2",{children:"Welcome to Chat"}),Object(c.jsx)("p",{children:"Progressive chat platform for neophytes"})]}),Object(c.jsxs)("div",{className:"mt-3",children:[Object(c.jsxs)(p.a,{block:!0,color:"blue",onClick:function(){e(new d.a.auth.FacebookAuthProvider)},children:[Object(c.jsx)(v.a,{icon:"facebook"})," Continue with Facebook"]}),Object(c.jsxs)(p.a,{block:!0,color:"green",onClick:function(){e(new d.a.auth.GoogleAuthProvider)},children:[Object(c.jsx)(v.a,{icon:"google"})," Continue with Google"]})]})]})})})})})},y=n(15),S=n(29),A=n(381),I=n(14),E={state:"offline",last_changed:d.a.database.ServerValue.TIMESTAMP},L={state:"online",last_changed:d.a.database.ServerValue.TIMESTAMP},T=Object(a.createContext)(),D=function(e){var t=e.children,n=Object(a.useState)(null),r=Object(I.a)(n,2),s=r[0],i=r[1],o=Object(a.useState)(!0),l=Object(I.a)(o,2),u=l[0],j=l[1];return Object(a.useEffect)((function(){var e,t,n=k.onAuthStateChanged((function(n){n?(e=w.ref("/profiles/".concat(n.uid)),t=w.ref("/status/".concat(n.uid)),e.on("value",(function(e){var t=e.val(),c={avatar:t.avatar,name:t.name,createdAt:t.createdAt,uid:n.uid,email:n.email};i(c),j(!1)})),w.ref(".info/connected").on("value",(function(e){!1!==!!e.val()&&t.onDisconnect().set(E).then((function(){t.set(L)}))}))):(e&&e.off(),t&&t.off(),w.ref(".info/connected").off(),i(null),j(!1))}));return function(){n(),w.ref(".info/connected").off(),e&&e.off()}}),[]),Object(c.jsx)(T.Provider,{value:{profile:s,isLoading:u},children:t})},P=function(){return Object(a.useContext)(T)},F=function(e){var t=e.children,n=Object(S.a)(e,["children"]),a=P(),r=a.profile,s=a.isLoading;return s&&!r?Object(c.jsx)(h.a,{children:Object(c.jsx)(A.a,{center:!0,vertical:!0,size:"md",content:"Loading",speed:"slow"})}):r||s?Object(c.jsx)(o.b,Object(y.a)(Object(y.a)({},n),{},{children:t})):Object(c.jsx)(o.a,{to:"/signin"})},U=n(387),H=n(41),B=n(382),M=n(368),R=n(383),V=n(369),z=n(384),q=n(374);function K(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Object(a.useState)(e),n=Object(I.a)(t,2),c=n[0],r=n[1],s=Object(a.useCallback)((function(){return r(!0)}),[]),i=Object(a.useCallback)((function(){return r(!1)}),[]);return{isOpen:c,open:s,close:i}}var W=function(e){var t=Object(a.useState)((function(){return window.matchMedia(e).matches})),n=Object(I.a)(t,2),c=n[0],r=n[1];return Object(a.useEffect)((function(){var t=window.matchMedia(e);r(t.matches);var n=function(e){return r(e.matches)};return t.addListener(n),function(){return t.removeListener(n)}}),[e]),c};var G=B.a.Types.StringType,J=B.a.Model({name:G().isRequired("Chat Name is required"),description:G().isRequired("Description is required")}),Y={name:"",description:""},_=function(){var e=K(),t=e.isOpen,n=e.open,r=e.close,s=Object(a.useRef)(),i=Object(a.useState)(Y),o=Object(I.a)(i,2),l=o[0],h=o[1],O=Object(a.useState)(!1),f=Object(I.a)(O,2),m=f[0],x=f[1],g=function(){var e=Object(j.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s.current.check()){e.next=2;break}return e.abrupt("return");case 2:return x(!0),t=Object(y.a)(Object(y.a)({},l),{},{createdAt:d.a.database.ServerValue.TIMESTAMP,admins:Object(H.a)({},k.currentUser.uid,!0)}),e.prev=4,e.next=7,w.ref("rooms").push(t);case 7:b.a.info("".concat(l.name," has been created")),x(!1),h(Y),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(4),x(!1),b.a.error(e.t0.message,4e3);case 16:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(){return e.apply(this,arguments)}}();return Object(c.jsxs)("div",{className:"mt-1",children:[Object(c.jsxs)(p.a,{block:!0,color:"green",onClick:n,children:[Object(c.jsx)(v.a,{icon:"creative"})," Create New Chat Room"]}),Object(c.jsxs)(M.a,{show:t,onHide:r,children:[Object(c.jsx)(M.a.Header,{children:Object(c.jsx)(M.a.Title,{children:"New Chat Room"})}),Object(c.jsx)(M.a.Body,{children:Object(c.jsxs)(R.a,{fluid:!0,onChange:function(e){h(e)},formValue:l,model:J,ref:s,children:[Object(c.jsxs)(V.a,{children:[Object(c.jsx)(z.a,{children:"Room Name"}),Object(c.jsx)(q.a,{name:"name",placeholder:"Enter new chat room name..."})]}),Object(c.jsxs)(V.a,{children:[Object(c.jsx)(z.a,{children:"Description"}),Object(c.jsx)(q.a,{componentClass:"textarea",rows:5,name:"description",placeholder:"Enter room description..."})]})]})}),Object(c.jsx)(M.a.Footer,{children:Object(c.jsx)(p.a,{block:!0,appearance:"primary",onClick:g,disabled:m,children:"Create New Chat Room"})})]})]})},Q=n(376),X=n(371),Z=n(191),$=function(e){var t=e.initialValue,n=e.onSave,r=(e.name,e.label),s=void 0===r?null:r,i=e.placeholder,o=void 0===i?"Write your value":i,l=e.emptymsg,d=void 0===l?"Input is Empty":l,h=e.wrapperClassName,O=void 0===h?"":h,f=Object(S.a)(e,["initialValue","onSave","name","label","placeholder","emptymsg","wrapperClassName"]),m=Object(a.useState)(t),x=Object(I.a)(m,2),p=x[0],g=x[1],k=Object(a.useState)(!1),w=Object(I.a)(k,2),C=w[0],N=w[1],A=Object(a.useCallback)((function(e){g(e)}),[]),E=Object(a.useCallback)((function(){N((function(e){return!e})),g(t)}),[t]),L=function(){var e=Object(j.a)(u.a.mark((function e(){var c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""===(c=p.trim())&&b.a.info(d,4e3),c===t){e.next=5;break}return e.next=5,n(c);case 5:N(!1);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(c.jsxs)("div",{className:O,children:[s,Object(c.jsxs)(X.a,{children:[Object(c.jsx)(Z.a,Object(y.a)(Object(y.a)({},f),{},{disabled:!C,placeholder:o,emptymsg:d,value:p,onChange:A})),Object(c.jsx)(X.a.Button,{onClick:E,children:Object(c.jsx)(v.a,{icon:C?"close":"edit2"})}),C&&Object(c.jsx)(X.a.Button,{onClick:L,children:Object(c.jsx)(v.a,{icon:"check"})})]})]})},ee=n(186),te=n.n(ee),ne=n(385);function ce(e){var t=e.toUpperCase().split(" ");return t.length>1?t[0][0]+t[1][0]:t[0][0]}function ae(e){return e?Object.keys(e).map((function(t){return Object(y.a)(Object(y.a)({},e[t]),{},{id:t})})):[]}function re(e,t,n,c){return se.apply(this,arguments)}function se(){return(se=Object(j.a)(u.a.mark((function e(t,n,c,a){var r,s,i,o,l,j,d;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r={})["/profiles/".concat(t,"/").concat(n)]=c,s=a.ref("/messages").orderByChild("author/uid").equalTo(t).once("value"),i=a.ref("/rooms").orderByChild("lastmessage/author/uid").equalTo(t).once("value"),e.next=6,Promise.all([s,i]);case 6:return o=e.sent,l=Object(I.a)(o,2),j=l[0],d=l[1],j.forEach((function(e){r["/messages/".concat(e.key,"/author/").concat(n)]=c})),d.forEach((function(e){r["/rooms/".concat(e.key,"/lastmessage/author/").concat(n)]=c})),e.abrupt("return",r);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ie=function(e){var t=e.name,n=Object(S.a)(e,["name"]);return Object(c.jsx)("div",{children:Object(c.jsx)(ne.a,Object(y.a)(Object(y.a)({circle:!0},n),{},{children:ce(t)}))})},oe=function(){var e=K(),t=e.isOpen,n=e.open,r=e.close,s=P().profile,i=Object(a.useState)(!1),o=Object(I.a)(i,2),l=o[0],d=o[1],h=Object(a.useState)(null),O=Object(I.a)(h,2),f=O[0],m=O[1],x=Object(a.useRef)(),v=function(e){return new Promise((function(t,n){e.toBlob((function(e){e?t(e):n(new Error("File process error"))}))}))},g=["image/png","image/jpeg","image/pjpeg"],k=function(){var e=Object(j.a)(u.a.mark((function e(){var t,n,c,a,r,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=x.current.getImageScaledToCanvas(),d(!0),e.prev=2,e.next=5,v(t);case 5:return n=e.sent,c=C.ref("/profiles/".concat(s.uid)).child("avatar"),e.next=9,c.put(n,{cacheControl:"public,max-age=".concat(259200)});case 9:return a=e.sent,e.next=12,a.ref.getDownloadURL();case 12:return r=e.sent,e.next=15,re(s.uid,"avatar",r,w);case 15:return i=e.sent,e.next=18,w.ref().update(i);case 18:b.a.info("Avatar has been uploaded",4e3),d(!1),e.next=26;break;case 22:e.prev=22,e.t0=e.catch(2),b.a.error(e.t0.message,4e3),d(!1);case 26:case"end":return e.stop()}}),e,null,[[2,22]])})));return function(){return e.apply(this,arguments)}}();return Object(c.jsx)("div",{className:"mt-3 text-center",children:Object(c.jsxs)("div",{children:[Object(c.jsx)(ie,{src:s.avatar,name:s.name,className:"width-200 height-200 img-fullsize font-huge"}),Object(c.jsxs)("label",{htmlFor:"avatar-upload",className:"d-block cursor-pointer padded",children:["Select new Avatar",Object(c.jsx)("input",{id:"avatar-upload",type:"file",className:"d-none",accept:".png, .jpeg, .jpg",onChange:function(e){var t=e.target.files;if(1===t.length){var c=t[0];!function(e){return g.includes(e.type)}(c)?b.a.warning("Wrong file type ".concat(c.type)):(m(c),n())}}})]}),Object(c.jsxs)(M.a,{show:t,onHide:r,children:[Object(c.jsx)(M.a.Header,{children:Object(c.jsx)(M.a.Title,{children:"Adjust and upload new avatar"})}),Object(c.jsx)(M.a.Body,{children:Object(c.jsx)("div",{className:"d-flex justify-content-center align-items-center h-100",children:f&&Object(c.jsx)(te.a,{ref:x,image:f,width:200,height:200,border:10,borderRadius:100,rotate:0})})}),Object(c.jsx)(M.a.Footer,{children:Object(c.jsx)(p.a,{block:!0,appearance:"ghost",onClick:k,disabled:l,children:"Upload new Avatar"})})]})]})})},le=n(386),ue=function(){var e=Object(a.useState)({"google.com":k.currentUser.providerData.some((function(e){return"google.com"===e.providerId})),"facebook.com":k.currentUser.providerData.some((function(e){return"facebook.com"===e.providerId}))}),t=Object(I.a)(e,2),n=t[0],r=t[1],s=function(e,t){r((function(n){return Object(y.a)(Object(y.a)({},n),{},Object(H.a)({},e,t))}))},i=function(){var e=Object(j.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,1!==k.currentUser.providerData.length){e.next=3;break}throw new Error("You can not unlink to ".concat(t));case 3:return e.next=5,k.currentUser.unlink(t);case 5:s(t,!1),b.a.info("Disconnected from ".concat(t)),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),b.a.error(e.t0.message,4e3);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),o=function(){var e=Object(j.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.currentUser.linkWithPopup(t);case 3:b.a.info("Linked to ".concat(t.providerId),4e3),s(t.providerId,!0),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),b.a.error(e.t0.message,4e3);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}();return Object(c.jsxs)("div",{children:[n["google.com"]&&Object(c.jsxs)(le.a,{color:"green",closable:!0,onClose:function(){i("google.com")},children:[Object(c.jsx)(v.a,{icon:"google"})," Connected"]}),n["facebook.com"]&&Object(c.jsxs)(le.a,{color:"blue",closable:!0,onClose:function(){i("facebook.com")},children:[Object(c.jsx)(v.a,{icon:"facebook"})," Connected"]}),Object(c.jsxs)("div",{className:"mt-2",children:[!n["google.com"]&&Object(c.jsxs)(p.a,{block:!0,color:"green",onClick:function(){o(new d.a.auth.GoogleAuthProvider)},children:[Object(c.jsx)(v.a,{icon:"google"})," Link to Google"]}),!n["facebook.com"]&&Object(c.jsxs)(p.a,{block:!0,color:"blue",onClick:function(){o(new d.a.auth.FacebookAuthProvider)},children:[Object(c.jsx)(v.a,{icon:"facebook"})," Link to Facebook"]})]})]})},je=function(e){var t=e.onSignout,n=P().profile,a=function(){var e=Object(j.a)(u.a.mark((function e(t){var c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,re(n.uid,"name",t,w);case 3:return c=e.sent,e.next=6,w.ref().update(c);case 6:b.a.success("Nickname has been updated",4e3),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),b.a.error(e.t0.message,4e3);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}();return Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)(Q.a.Header,{children:Object(c.jsx)(Q.a.Title,{children:"Dashboard"})}),Object(c.jsxs)(Q.a.Body,{children:[Object(c.jsxs)("h3",{children:["Hey, ",n.name]}),Object(c.jsx)(ue,{}),Object(c.jsx)(U.a,{}),Object(c.jsx)($,{name:"nickname",initialValue:n.name,onSave:a,label:Object(c.jsx)("h6",{className:"mb-2",children:"Nickname"})}),Object(c.jsx)(oe,{})]}),Object(c.jsx)(Q.a.Footer,{children:Object(c.jsx)(p.a,{block:!0,color:"red",onClick:t,children:"Sign Out"})})]})},de=function(){var e=K(),t=e.isOpen,n=e.open,r=e.close,s=W("(max-width:992px)"),i=Object(a.useCallback)((function(){w.ref("status/".concat(k.currentUser.uid)).set(E).then((function(){k.signOut(),b.a.info("Signed Out",4e3),r()})).catch((function(e){b.a.error(e.message,4e3)}))}),[r]);return Object(c.jsxs)(c.Fragment,{children:[Object(c.jsxs)(p.a,{block:!0,color:"blue",onClick:n,children:[Object(c.jsx)(v.a,{icon:"dashboard"})," Dashboard"]}),Object(c.jsx)(Q.a,{full:s,show:t,onHide:r,placement:"left",children:Object(c.jsx)(je,{onSignout:i})})]})},be=n(372),he=Object(a.createContext)(),Oe=function(e){var t=e.children,n=Object(a.useState)(null),r=Object(I.a)(n,2),s=r[0],i=r[1];return Object(a.useEffect)((function(){var e=w.ref("rooms");return e.on("value",(function(e){var t=ae(e.val());i(t)})),function(){e.off()}})),Object(c.jsx)(he.Provider,{value:s,children:t})},fe=function(){return Object(a.useContext)(he)},me=n(87),xe=function(e){var t=e.room,n=t.createdAt,a=t.name,r=t.lastmessage;return Object(c.jsxs)("div",{children:[Object(c.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[Object(c.jsx)("h3",{className:"text-disappear",children:a}),Object(c.jsx)(me.a,{className:"font-normal text-black-45",datetime:r?new Date(r.createdAt):new Date(n)})]}),Object(c.jsx)("div",{className:"d-flex align-items-center text-black-70",children:r?Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)("div",{className:"d-flex align-items-center",children:Object(c.jsx)(ie,{src:r.author.avatar,name:r.author.name,size:"sm"})}),Object(c.jsxs)("div",{className:"text-disappear ml-2",children:[Object(c.jsx)("div",{className:"italic",children:r.author.name}),Object(c.jsx)("span",{children:r.text})]})]}):Object(c.jsx)("span",{children:"No messages yet..."})})]})},pe=function(e){var t=e.aboveElHeight,n=Object(o.g)(),a=fe();return Object(c.jsxs)(be.a,{appearance:"subtle",vertical:!0,reversed:!0,className:"overflow-y-scroll custom-scroll",style:{height:"calc(100% - ".concat(t,"px)")},activeKey:n.pathname,children:[!a&&Object(c.jsx)(A.a,{center:!0,vertical:!0,content:"Loading",speed:"slow",size:"md"}),a&&a.length>0&&a.map((function(e){return Object(c.jsx)(be.a.Item,{componentClass:i.b,to:"/chat/".concat(e.id),eventKey:"/chat/".concat(e.id),children:Object(c.jsx)(xe,{room:e})},e.id)}))]})},ve=function(){var e=Object(a.useRef)(),t=Object(a.useState)(0),n=Object(I.a)(t,2),r=n[0],s=n[1];return Object(a.useEffect)((function(){e.current&&s(e.current.scrollHeight)}),[e]),Object(c.jsxs)("div",{className:"h-100 pt-2",children:[Object(c.jsxs)("div",{ref:e,children:[Object(c.jsx)(de,{}),Object(c.jsx)(_,{}),Object(c.jsx)(U.a,{children:"Join Conversation"})]}),Object(c.jsx)(pe,{aboveElHeight:r})]})},ge=n(388),ke=n(131),we=Object(ke.a)(),Ce=function(e){var t=e.children,n=e.data;return Object(c.jsx)(we.Provider,{value:n,children:t})},Ne=function(e){return Object(ke.b)(we,e)},ye=function(){var e=K(),t=e.isOpen,n=e.close,a=e.open,r=Object(o.h)().chatId,s=W("(max-width:992px)"),i=Ne((function(e){return e.name})),l=Ne((function(e){return e.description})),u=function(e,t){w.ref("/rooms/".concat(r)).child(e).set(t).then((function(){b.a.success("Successfully Updated",4e3)})).catch((function(e){b.a.error(e.message,4e3)}))};return Object(c.jsxs)("div",{children:[Object(c.jsx)(p.a,{className:"br-circle",size:"sm",color:"red",onClick:a,children:"A"}),Object(c.jsxs)(Q.a,{full:s,show:t,onHide:n,placement:"right",children:[Object(c.jsx)(Q.a.Header,{children:Object(c.jsx)(Q.a.Title,{children:"Edit Room"})}),Object(c.jsxs)(Q.a.Body,{children:[Object(c.jsx)($,{initialValue:i,label:Object(c.jsx)("h6",{className:"mb-2",children:"Name"}),emptyMsg:"Name cannot be empty",onSave:function(e){u("name",e)}}),Object(c.jsx)($,{componentClass:"textarea",rows:5,initialValue:l,emptymsg:"description cannot be empty",wrapperClassName:"mt-3",onSave:function(e){u("description",e)}})]}),Object(c.jsx)(Q.a.Footer,{children:Object(c.jsx)(p.a,{block:!0,onClick:n,children:"close"})})]})]})},Se=Object(a.memo)(ye),Ae=function(){var e=Ne((function(e){return e.description})),t=Ne((function(e){return e.name})),n=K(),a=n.isOpen,r=n.open,s=n.close;return Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)(p.a,{appearance:"link",className:"px-0",onClick:r,children:"Room Information"}),Object(c.jsxs)(M.a,{show:a,onHide:s,children:[Object(c.jsx)(M.a.Header,{children:Object(c.jsxs)(M.a.Title,{children:["About ",t]})}),Object(c.jsxs)(M.a.Body,{children:[Object(c.jsx)("h6",{className:"mb-1",children:"Description"}),Object(c.jsx)("p",{children:e})]}),Object(c.jsx)(M.a.Footer,{children:Object(c.jsx)(p.a,{block:!0,onClick:s,children:"Close"})})]})]})},Ie=Object(a.memo)(Ae),Ee=function(){var e=Ne((function(e){return e.name})),t=Ne((function(e){return e.isAdmin})),n=W("(max-width:992px)");return Object(c.jsxs)("div",{children:[Object(c.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[Object(c.jsxs)("h4",{className:"text-disappear d-flex align-items-center",children:[Object(c.jsx)(v.a,{componentClass:i.b,to:"/",icon:"arrow-circle-left",size:"2x",className:n?"d-inline-block p-0 mr-2 text-blue link-unstyled":"d-none"}),Object(c.jsx)("span",{className:"text-disappear",children:e})]}),Object(c.jsx)(ge.a,{className:"ws-nowrap",children:t&&Object(c.jsx)(Se,{})})]}),Object(c.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[Object(c.jsx)("span",{children:"todo"}),Object(c.jsx)(Ie,{})]})]})},Le=Object(a.memo)(Ee),Te=n(190),De=n(193),Pe=n(389),Fe=function(e){if(!e)return"gray";switch(e.state){case"online":return"green";case"offline":return"red";default:return"gray"}},Ue=function(e){return e?"online"===e.state?"Online":"Last Online ".concat(new Date(e.last_changed).toLocaleDateString()):"Unknown user"},He=function(e){var t=function(e){var t=Object(a.useState)(null),n=Object(I.a)(t,2),c=n[0],r=n[1];return Object(a.useEffect)((function(){var t=w.ref("/status/".concat(e));return t.on("value",(function(e){if(e.exists){var t=e.val();r(t)}})),function(){t.off()}}),[e]),c}(e.uid);return Object(c.jsx)(Te.a,{placement:"top",trigger:"hover",speaker:Object(c.jsx)(De.a,{children:Ue(t)}),children:Object(c.jsx)(Pe.a,{className:"cursor-pointer",style:{backgroundColor:Fe(t)}})})},Be=function(e){var t=e.profile,n=e.children,a=Object(S.a)(e,["profile","children"]),r=K(),s=r.isOpen,i=r.close,o=r.open,l=t.name,u=t.avatar,j=t.createdAt,d=l.split(" ")[0],b=new Date(j).toLocaleDateString();return Object(c.jsxs)("div",{children:[Object(c.jsx)(p.a,Object(y.a)(Object(y.a)({},a),{},{onClick:o,children:d})),Object(c.jsxs)(M.a,{show:s,onHide:i,children:[Object(c.jsx)(M.a.Header,{children:Object(c.jsxs)(M.a.Title,{children:[d," profile"]})}),Object(c.jsxs)(M.a.Body,{className:"text-center",children:[Object(c.jsx)(ie,{src:u,name:l,className:"width-200 height-200 img-fullsize font-huge"}),Object(c.jsxs)("h4",{className:"mt-2",children:[l," "]}),Object(c.jsxs)("p",{children:["Member Since ",b]})]}),Object(c.jsxs)(M.a.Footer,{children:[n,Object(c.jsx)(p.a,{block:!0,onClick:i,children:"close"})]})]})]})},Me=n(192),Re=function(e){var t=e.condition,n=e.children;return t?Object(c.jsx)(Pe.a,{content:t,children:a.Children}):n},Ve=function(e){var t=e.isVisible,n=e.iconName,a=e.tooltip,r=e.onClick,s=e.badgeContent,i=Object(S.a)(e,["isVisible","iconName","tooltip","onClick","badgeContent"]);return Object(c.jsx)("div",{className:"ml-2",style:{visibility:t?"visible":"hidden"},children:Object(c.jsx)(Re,{condition:s,children:Object(c.jsx)(Te.a,{placement:"top",delay:0,delayHide:0,delayShow:0,trigger:"hover",speaker:Object(c.jsx)(De.a,{children:a}),children:Object(c.jsx)(Me.a,Object(y.a)(Object(y.a)({},i),{},{onClick:r,circle:!0,size:"xs",icon:Object(c.jsx)(v.a,{icon:n})}))})})})},ze=function(e){var t=e.message,n=e.handleAdmin,r=e.handleLike,s=t.author,i=t.createdAt,o=t.text,l=t.likes,u=t.likeCount,j=function(){var e=Object(a.useState)(!1),t=Object(I.a)(e,2),n=t[0],c=t[1],r=Object(a.useRef)(null),s=function(){return c(!0)},i=function(){return c(!1)};return Object(a.useEffect)((function(){var e=r.current;return e&&(e.addEventListener("mouseover",s),e.addEventListener("mouseout",i)),function(){e.removeEventListener("mouseover",s),e.removeEventListener("mouseout",i)}}),[r.current]),[r,n]}(),d=Object(I.a)(j,2),b=d[0],h=d[1],O=Ne((function(e){return e.isAdmin})),f=Ne((function(e){return e.admins})),m=W("(max-width:992px)"),x=f.includes(s.uid),v=k.currentUser.uid===s.uid,g=O&&!v,w=l&&Object.keys(l).includes(k.currentUser.uid),C=m||h;return Object(c.jsxs)("li",{className:"padded mb-1 cursor-pointer ".concat(h?"bg-black-02":""," "),ref:b,children:[Object(c.jsxs)("div",{className:"d-flex align-items-center font-bolder mb-1",children:[Object(c.jsx)(He,{uid:s.uid}),Object(c.jsx)(ie,{src:s.avatar,name:s.name,className:"ml-1",size:"xs"}),Object(c.jsx)(Be,{profile:s,appearance:"link",className:"p-0 ml-1 text-black",children:g&&Object(c.jsx)(p.a,{onClick:function(){return n(s.uid)},color:"blue",block:!0,children:x?"Remove Admin":"Make Admin"})}),Object(c.jsx)(me.a,{className:"font-normal text-black-45 ml-2",datetime:i}),Object(c.jsx)(Ve,Object(y.a)(Object(y.a)({},w?{color:"red"}:{}),{},{isVisible:C,iconName:"heart",tooltip:"Like this message",onClick:function(){return r(t.id)},badgeContent:u}))]}),Object(c.jsx)("div",{children:Object(c.jsx)("span",{className:"word-break-all",children:o})})]})},qe=function(){var e=Object(o.h)().chatId,t=Object(a.useState)(),n=Object(I.a)(t,2),r=n[0],s=n[1],i=r&&0===r.length,l=r&&r.length>0;Object(a.useEffect)((function(){var t=w.ref("/messages");return t.orderByChild("roomId").equalTo(e).on("value",(function(e){var t=ae(e.val());s(t)})),function(){t.off("value")}}),[e]);var d=Object(a.useCallback)(function(){var t=Object(j.a)(u.a.mark((function t(n){var c,a;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=w.ref("/rooms/".concat(e,"/admins")),t.next=3,a.transaction((function(e){return e&&(e[n]?(e[n]=null,c="Removed as Admin"):(e[n]=!0,c="Admin Permission Granted"),b.a.info(c,4e3)),e}));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[e]),h=Object(a.useCallback)(function(){var e=Object(j.a)(u.a.mark((function e(t){var n,c,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=k.currentUser.uid,a=w.ref("/messages/".concat(t)),e.next=4,a.transaction((function(e){return e&&(e.likes&&e.likes[c]?(e.likeCount-=1,e.likes[c]=null,n="Like Removed"):(e.likeCount+=1,e.likes||(e.likes={}),e.likes[c]=!0,n="Like added"),b.a.info(n,4e3)),e}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]);return Object(c.jsxs)("ul",{className:"msg-list custom-scroll",children:[i&&Object(c.jsx)("li",{children:"No Message Yet"}),l&&r.map((function(e){return Object(c.jsx)(ze,{message:e,handleAdmin:d,handleLike:h},e.id)}))]})};function Ke(e,t){return{roomId:t,author:Object(y.a)({name:e.name,uid:e.uid,createdAt:e.createdAt},e.avatar?{avatar:e.avatar}:{}),likeCount:0,createdAt:d.a.database.ServerValue.TIMESTAMP}}var We=function(){var e=Object(a.useState)(""),t=Object(I.a)(e,2),n=t[0],r=t[1],s=Object(a.useState)(!1),i=Object(I.a)(s,2),l=i[0],d=i[1],h=P().profile,O=Object(o.h)().chatId,f=Object(a.useCallback)((function(e){r(e)}),[]),m=function(){var e=Object(j.a)(u.a.mark((function e(){var t,c,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==n.trim){e.next=2;break}return e.abrupt("return");case 2:return(t=Ke(h,O)).text=n,c={},a=w.ref("messages").push().key,c["/messages/".concat(a)]=t,c["/rooms/".concat(O,"/lastmessage")]=Object(y.a)(Object(y.a)({},t),{},{msgId:a}),d(!0),e.prev=9,e.next=12,w.ref().update(c);case 12:r(""),d(!1),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(9),d(!1),b.a.error(e.t0.message,4e3);case 20:case"end":return e.stop()}}),e,null,[[9,16]])})));return function(){return e.apply(this,arguments)}}();return Object(c.jsx)("div",{children:Object(c.jsxs)(X.a,{children:[Object(c.jsx)(Z.a,{placeholder:"Write new message here...",value:n,onChange:f,onKeyDown:function(e){13===e.keyCode&&(e.preventDefault(),m())}}),Object(c.jsx)(X.a.Button,{color:"blue",appearance:"primary",onClick:m,disabled:l,children:Object(c.jsx)(v.a,{icon:"send"})})]})})},Ge=function(){var e=Object(o.h)().chatId,t=fe();if(!t)return Object(c.jsx)(A.a,{center:!0,vertical:!0,size:"md",content:"Loading",speed:"slow"});var n=t.find((function(t){return t.id===e}));if(!n)return Object(c.jsxs)("h6",{className:"text-center mt-page",children:["Chat ",e," not found"]});var a,r=n.name,s=n.description,i=(a=n.admins)?Object.keys(a):[],l=i.includes(k.currentUser.uid),u={name:r,description:s,admins:i,isAdmin:l};return Object(c.jsxs)(Ce,{data:u,children:[Object(c.jsx)("div",{className:"chat-top",children:Object(c.jsx)(Le,{})}),Object(c.jsx)("div",{className:"chat-middle",children:Object(c.jsx)(qe,{})}),Object(c.jsx)("div",{className:"chat-bottom",children:Object(c.jsx)(We,{})})]})},Je=function(){var e=W("(min-width:992px)"),t=Object(o.i)().isExact,n=e||t;return Object(c.jsx)(Oe,{children:Object(c.jsx)(O.a,{fluid:!0,className:"h-100",children:Object(c.jsxs)(f.a,{className:"h-100",children:[n&&Object(c.jsx)(m.a,{xs:24,md:8,className:"h-100",children:Object(c.jsx)(ve,{})}),Object(c.jsx)(o.d,{children:Object(c.jsx)(o.b,{exact:!0,path:"/chat/:chatId",children:Object(c.jsx)(m.a,{xs:24,md:16,className:"h-100",children:Object(c.jsx)(Ge,{})})})}),Object(c.jsx)(o.b,{children:t&&Object(c.jsx)(m.a,{xs:24,md:16,className:"h-100",children:Object(c.jsx)("h6",{className:"text-center mt-page",children:"Please Select Chat"})})})]})})})},Ye=function(e){var t=e.children,n=Object(S.a)(e,["children"]),a=P(),r=a.profile,s=a.isLoading;return s&&!r?Object(c.jsx)(h.a,{children:Object(c.jsx)(A.a,{center:!0,vertical:!0,size:"md",content:"Loading",speed:"slow"})}):r&&!s?Object(c.jsx)(o.a,{to:"/"}):Object(c.jsx)(o.b,Object(y.a)(Object(y.a)({},n),{},{children:t}))};var _e=function(){return Object(c.jsx)(D,{children:Object(c.jsxs)(o.d,{children:[Object(c.jsx)(Ye,{path:"/signin",children:Object(c.jsx)(N,{})}),Object(c.jsx)(F,{path:"/",children:Object(c.jsx)(Je,{})})]})})},Qe=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,390)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,r=t.getLCP,s=t.getTTFB;n(e),c(e),a(e),r(e),s(e)}))};s.a.render(Object(c.jsx)(i.a,{children:Object(c.jsx)(_e,{})}),document.getElementById("root")),Qe()}},[[364,1,2]]]);
//# sourceMappingURL=main.37faed15.chunk.js.map